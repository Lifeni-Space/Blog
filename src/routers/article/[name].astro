---
export interface Props {
  article: Article
}

import Layout from 'component:Layout'

import Actions from 'component:article/Actions'
import Comments from 'component:article/Comments'
import Indexes from 'component:article/Indexes'

export async function getStaticPaths() {
  const files = Astro.fetchContent(
    '../../../contents/articles/*.md'
  ) as Article[]

  return files.map(file => ({
    params: { name: file.name },
    props: { article: file },
  }))
}

const { article } = Astro.props as Props

const highlight = Astro.resolve('../../assets/highlight.css')
const markdown = Astro.resolve('../../markdown.less')
---

<Layout title={article.title} description={article.description}>
  <Fragment slot="head">
    <link rel="stylesheet" href={highlight} />
    <link rel="stylesheet" href={markdown} />
  </Fragment>

  <article set:html={article.astro.html}></article>
  <Actions date={article.date} license={article.license} />
  {article.astro.headers.length !== 1 && (
    <Indexes headers={article.astro.headers} />
  )}
  <!-- <Comments /> -->
</Layout>

<script type="module" defer>
  const images = document.querySelectorAll('article img')
  if (images.length !== 0) {
    const zoom = await import('https://cdn.skypack.dev/medium-zoom')
    zoom.default(images, { background: 'rgba(0, 0, 0, 0.8)' })
  }
</script>

<style lang="less">
  :global(body) {
    background-color: var(--background) !important;
  }
</style>
