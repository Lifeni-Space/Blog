---
import App from '@components/App.astro'
import Footer from '@components/base/Footer.astro'
import Header from '@components/base/Header.astro'
import List from '@components/notebook/List.astro'
import { getCollection } from 'astro:content'
import type { Archive, Article } from 'types'
import { navs } from '@libs/consts'

export const format = (data: Archive): Article => ({
  name: data.title,
  description: data.description,
  id: data.name,
  license: data.license,
  date: {
    created: data['create-date'],
    updated: data.date,
  },
  cover: undefined,
  tags: undefined,
  subtitle: undefined,
  draft: false,
})

const archives = (await getCollection('存档'))
  .map(({ data, ...props }) => ({
    ...props,
    data: { ...data, ...format(data) },
  }))
  .map(({ data }) => data)
  .filter(({ draft }) => import.meta.env.DEV || !draft)
  .sort((a, b) => b.date.created.getTime() - a.date.created.getTime())
---

<App scope="记录干杯" name="存档">
  <Header slot="header" action="更多" links={navs} />
  <Footer slot="footer" />
  <List type="存档" name="文章存档" suffix="篇文章" contents={archives} />
</App>
